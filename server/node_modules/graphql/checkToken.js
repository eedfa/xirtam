const { errorNames, jwtSecret } = require('./constants')
const jwt = require('jsonwebtoken')
function checkLoggedIn (req, context) {
  var token = req.request.headers['x-access-token']
  console.log(token)
  if (!token) {
    try {
      throw new Error(errorNames.NOTOKEN)
    } catch (err) {
      throw err.message
    }
  }
  try {
    var decoded = jwt.verify(token, jwtSecret)
  } catch (err) {
    throw err.message
  }
  console.log('decoded')
  console.log(decoded)
  context.userId = decoded
}
module.exports = { checkLoggedIn }
